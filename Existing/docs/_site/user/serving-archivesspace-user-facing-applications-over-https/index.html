<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serving ArchivesSpace user-facing applications over HTTPS - ArchivesSpace</title>
    <link rel="stylesheet" href="/archivesspace/assets/stylesheets/main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
    <script src="/archivesspace/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
    <script src="/archivesspace/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
    <link rel="alternate" type="application/atom+xml" href="/blog.xml">
  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://archivesspace.org/" title="ArchivesSpace">ArchivesSpace</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://archivesspace.atlassian.net/wiki/display/ADC/ArchivesSpace">Wiki</a></li>
        <li><a href="http://docs.archivesspace.org">User Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form onsubmit='google_site_search()'>
        <input type="text" id="google-search" class="searchbox-input" placeholder="Search the docs" />
      </form>

      <script language="Javascript" type="text/javascript">
          function google_site_search()
            {
                var query = document.getElementById("google-search").value;
                  window.open("http://google.com/search?q=" + query
                  + "%20site:" + "http://archivesspace.github.io/archivesspace");
                  }
                </script>
    </div>
  </div>
  <!-- <section>
    <h2>Newsletter</h2>
    <div id="mc_embed_signup" style="margin-left: 1.5em; margin-top: 0.5em;">
      <form
         action="http://travis-ci.us7.list-manage.com/subscribe/post?u=8ce724a4c9af4dace663cd39c&amp;id=44f8dff14c"
         method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
         target="_blank" novalidate>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required/>
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
      </form>
    </div>
  </section>
  <section>
    <h2><a href="http://travis-ci.com/?utm_source=docs.travis-ci.org&utm_medium=referral&utm_content=textlink&utm_campaign=docsite_sidebar">Travis CI for Private Repositories</a></h2>
  </section> -->

  <section>
    <h2>Menu</h2>
    <nav>
      <ul>
        <li><a href="/archivesspace/user/system-requirements/">System Requirements</a></li>
        <li><a href="/archivesspace/user/getting-started/">Getting started</a></li>
        <li><a href="/archivesspace/user/configuring-archivesspace/">Configuring ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/upgrading-to-a-new-release-of-archivesspace/">Upgrading ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-as-a-unix-daemon/">Running ArchivesSpace as a Unix daemon</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-as-a-windows-service/">Running ArchivesSpace as a Windows Service</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-against-mysql/">Setting up MySQL for Production</a></li>
        <li><a href="/archivesspace/user/backup-and-recovery/">Backup and Recovery</a></li>
        <li><a href="/archivesspace/user/re-creating-indexes/">Re-creating your indexes</a></li>
        <li><a href="/archivesspace/user/resetting-passwords/">Resetting Passwords</a></li>
        <li><a href="/archivesspace/user/tuning-archivesspace/">Tuning ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/configuring-ldap-authentication/">Configuring LDAP authentication</a></li>
        <li><a href="/archivesspace/user/archivesspace-plug-ins-readme/">Plugins and Local Customizations</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-under-a-prefix/">Deploying under a URL prefix</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-with-external-solr/">Using an external Solr index</a></li>
        <li><a href="/archivesspace/user/application-monitoring-with-new-relic/">Monitoring with New Relic</a></li>
      </ul>
      <h2>Developer Guides</h2>
      <ul>
        <li><a href="/archivesspace/user/archivesspace-architecture-overview">Architecture Overview</a></li>
        <li><a href="/archivesspace/api">The API</a></li>
        <li><a href="/archivesspace/user/archivesspace-build-system">Building ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/selenium-test-suite">Running Selenium Tests</a></li>
        <li><a href="/archivesspace/doc">Ruby YARD Documentation</a></li>
        <li><div class="status-circle status">Status:</div>
          <a href="https://travis-ci.org/archivesspace/archivesspace">Travis CI Status</a>
        </li>
      </ul>
    </nav>
  </section>
  <section>
    <h2>Contact</h2>
    <ul>
      <li><a href="https://twitter.com/archivesspace">Twitter</a></li>
      <li><a href="irc://chat.freenode.net/%23archivesspace">IRC</a></li>
      <li><a href="http://github.com/archivesspace">GitHub</a></li>
      <li><a href="mailto:ArchivesSpaceHome@lyrasis.org">Email</a></li>
    </ul>
  </section>
  <section>
    <h2>Contributing</h2>
    <p>This documentation site is open source.
      The <a href="https://github.com/archivesspace/archivesspace/tree/gh-pages">README in our Git repository</a> explains how to contribute.</p>
      <p>This documentation was based on the <a href="https://travis-ci.org">Travis CI</a> documentation. It uses <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/tripit/slate">Slate</a></p>
  </section>
</div><!-- /#sidebar -->


        <main id="main" class="main">
          
            <h1 class="title">Serving ArchivesSpace user-facing applications over HTTPS</h2>
          
          <p>==============================================================</p>

<p>This document describes a simple approach for those wishing to install
ArchivesSpace in such a manner that all end-user requests (i.e., URLs)
are served over HTTPS rather than HTTP.</p>

<p>The configuration described in this document is one possible approach,
and to keep things simple the following are assumed:</p>

<ul>
  <li>
    <p>ArchivesSpace is running on a single Linux server</p>
  </li>
  <li>
    <p>The server is running the Apache 2.2+ webserver</p>
  </li>
  <li>
    <p>You have obtained an SSL certificate and key from an authority</p>
  </li>
</ul>

<p>Unless otherwise stated, it is assumed that you have root access on
your machines, and all commands are to be run as root (or with sudo).</p>

<h2 id="step-1-restrict-access-to-application-urls">Step 1: restrict access to application urls</h2>

<p>The standard ArchivesSpace distribution consists of four separate web
applications. By default, the applications are assigned to the following
urls:</p>

<ul>
  <li>
    <p>Backend - <code class="highlighter-rouge">http://localhost:8089</code></p>
  </li>
  <li>
    <p>Frontend (staff UI) - <code class="highlighter-rouge">http://localhost:8080</code></p>
  </li>
  <li>
    <p>Public (read-only UI) - <code class="highlighter-rouge">http://localhost:8081</code></p>
  </li>
  <li>
    <p>Solr (search middleware) - <code class="highlighter-rouge">http://localhost:8090</code></p>
  </li>
</ul>

<p>These assignments can be altered through edits to the configuration file
located at <code class="highlighter-rouge">archivesspace/config/config.rb</code> in the standard distribution.</p>

<p>Since the four component applications must be able to communicate with each
other over HTTP, the first step will be to restrict access to ports <code class="highlighter-rouge">8089</code>,
 <code class="highlighter-rouge">8080</code>, <code class="highlighter-rouge">8081</code>, and <code class="highlighter-rouge">8090</code> to the localhost. On a Linux server, this can be
 done using iptables:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> iptables -A INPUT -p tcp -s localhost --dport 8089 -j ACCEPT
 iptables -A INPUT -p tcp --dport 8089 -j DROP
 iptables -A INPUT -p tcp -s localhost --dport 8080 -j ACCEPT
 iptables -A INPUT -p tcp --dport 8080 -j DROP
 iptables -A INPUT -p tcp -s localhost --dport 8081 -j ACCEPT
 iptables -A INPUT -p tcp --dport 8081 -j DROP
 iptables -A INPUT -p tcp -s localhost --dport 8090 -j ACCEPT
 iptables -A INPUT -p tcp --dport 8090 -j DROP
</code></pre></div></div>

<p>Once this is done, it should be possible to start up the application without
exposing it to the outside world.</p>

<h2 id="step-2-use-mod_ssl-and-mod_proxy-to-serve-archivesspace-over-https">Step 2: use mod_ssl and mod_proxy to serve ArchivesSpace over HTTPS</h2>

<p>In order for archivists and researchers to access the application, there will
need to be two URLs that are exposed to the outside world, and per the main
requirement of this exercise, those URLs will need to begin with <code class="highlighter-rouge">https://</code>.
Letâ€™s assume that they will be:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">https://staff.myarchive.org</code> - for archival staff</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">https://research.myarchive.org</code> - for the public</p>
  </li>
</ul>

<p>Start by ensuring that Apache is configured to handle HTTPS requests. Locate
the <code class="highlighter-rouge">httpd.conf</code> file and ensure that it contains this line (or similar):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> LoadModule ssl_module modules/mod_ssl.so
</code></pre></div></div>

<p>If it is commented out, uncomment it.</p>

<p>Likewise, ensure that the Apache mod_proxy module is enabled:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> LoadModule proxy_module modules/mod_proxy.so
</code></pre></div></div>

<p>The following edits can be made in the httpd.conf file itself; however, it is
conventional to use the <code class="highlighter-rouge">Include</code> directive to load them from a file
named <code class="highlighter-rouge">ssl.conf</code>, <code class="highlighter-rouge">httpd-ssl.conf</code>, or the like. Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Include "/path/to/apache/extra/ssl.conf"
</code></pre></div></div>

<p>Make sure Apache is listening on port 443 (or whatever port you choose):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Listen 443
</code></pre></div></div>

<p>Finally, use the <code class="highlighter-rouge">NameVirtualHost</code> and <code class="highlighter-rouge">VirtualHost</code> directives to proxy
requests to the actual application urls. Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> NameVirtualHost *:443

 &lt;VirtualHost *:443&gt;
   ServerName staff.myarchive.org
   SSLEngine On
   SSLCertificateFile "/path/to/your/cert.crt"
   SSLCertificateKeyFile "/path/to/your/key.key"
   RequestHeader set X-Forwarded-Proto "https"
   ProxyPreserveHost On
   ProxyPass / http://localhost:8080/
   ProxyPassReverse / http://localhost:8080/
 &lt;/VirtualHost&gt;
 &lt;VirtualHost *:443&gt;
   ServerName research.myarchive.org
   SSLEngine On
   SSLCertificateFile "/path/to/your/cert.crt"
   SSLCertificateKeyFile "/path/to/your/key.key"
   RequestHeader set X-Forwarded-Proto "https"
   ProxyPreserveHost On
   ProxyPass / http://localhost:8081/
   ProxyPassReverse / http://localhost:8081/
 &lt;/VirtualHost&gt;
</code></pre></div></div>

<p>More information about configuring Apache for SSL can be found at
http://httpd.apache.org/docs/current/ssl/ssl_howto.html.  You should read
that documentation before attempting to configure SSL.</p>

        </main>
      </div><!-- /#content -->

      <footer>
  <div class="row">
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
